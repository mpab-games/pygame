#!/usr/bin/env sh

$(return >/dev/null 2>&1)
[ "$?" -ne "0" ] && echo "ERROR: $0 must be sourced to activate environment" && exit

export PYTHON_ENVIRONMENT="venv-$(uname)"

python_command() {
  if ! [ -d ./$PYTHON_ENVIRONMENT ]; then
      echo creating environment: $PYTHON_ENVIRONMENT using $PYTHON_CMD -m venv ./$PYTHON_ENVIRONMENT
      $PYTHON_CMD -m venv ./$PYTHON_ENVIRONMENT
  fi

  if [ -d ./$PYTHON_ENVIRONMENT ]; then
      echo found environment: $PYTHON_ENVIRONMENT
  fi

  if [ -e ./$PYTHON_ENVIRONMENT/Scripts/activate ]; then
    echo activating environment: ./$PYTHON_ENVIRONMENT/Scripts/activate
    . ./$PYTHON_ENVIRONMENT/Scripts/activate
  fi

  if [ -e ./$PYTHON_ENVIRONMENT/bin/activate ]; then
    echo activating environment: ./$PYTHON_ENVIRONMENT/bin/activate
    . ./$PYTHON_ENVIRONMENT/bin/activate
  fi
}

export PYTHON_CMD=

if [ $(command -v py) ]; then
  export PYTHON_CMD=py
  python_command
  return
fi

if [ $(command -v python) ]; then
  export PYTHON_CMD=python
  python_command
  return
fi

if [ $(command -v python3) ]; then
  export PYTHON_CMD=python3
  python_command
  return
fi

if [ $(command -v python2) ]; then
  export PYTHON_CMD=python2
  python_command
  return
fi

echo 'python not found - cannot set environment'
